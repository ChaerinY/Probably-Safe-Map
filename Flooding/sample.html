<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>simpleMap</title>
    <script
        src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=tpNuEruLIF71bSnC42azK4ddpJ6O9wd86xEVwmCQ"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            width: 100%;
            height: 95vh;
        }
    </style>
</head>

<body>
    <h1>simpleMap</h1>
    <div id="map"></div>
    <button id="showRectangleButton">사각형 표시</button>

    <script>
        function getUserLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject("위치 정보가 지원되지 않습니다.");
                } else {
                    navigator.geolocation.getCurrentPosition(
                        position => resolve(position),
                        error => reject(error)
                    );
                }
            });
        }

        var map;
        var rect;

        async function drawMap() {
            try {
                const position = await getUserLocation();
                console.log(position);
                //alert(`위도: ${position.coords.latitude}, 경도: ${position.coords.longitude}`);
                map = new Tmapv2.Map("map", {
                    center: new Tmapv2.LatLng(position.coords.latitude, position.coords.longitude),
                    width: "100%",
                    height: "95vh",
                    zoom: 12,
                });
            } catch (error) {
                console.error(error);
                // 위치 정보를 얻을 수 없을 때 부경대를 센터로 지정
                map = new Tmapv2.Map("map", {
                    center: new Tmapv2.LatLng(35.133238684709, 129.10144001966),
                    width: "100%",
                    height: "95vh",
                    zoom: 10,
                });
            }
        }

        function showRectangle() {
            if (!rect) {
                rect = new Tmapv2.Rectangle({
                    bounds: new Tmapv2.LatLngBounds(
                        new Tmapv2.LatLng(35.13323868, 129.1014400),
                        new Tmapv2.LatLng(35.13343868, 129.1014800)
                    ),
                    strokeColor: "red",
                    fillColor: "green",
                    map: map
                });
            } else {
                if (rect.getMap()) {
                    rect.setMap(null);
                } else {
                    rect.setMap(map);
                }
            }
        }

        drawMap();
        document.getElementById("showRectangleButton").addEventListener("click", showRectangle);


        const floodingUrl = 'http://apis.data.go.kr/6260000/BusanWaterImrsnInfoService/getWaterImrsnInfo?serviceKey=zLzLsz6TwuV3XckkNxeibskoB4TQWO%2B4E0Ob3QC4SLnFpBdhF%2BhH9BEm0%2FdPZPrCYKbtcj12ixLGeX24tWYSig%3D%3D&pageNo=1&numOfRows=10&resultType=json';
        
        fetch(floodingUrl)
        .then((res) => res.json())
        .then((resJson) => {
            const flood = resJson.item;

            console.log(flood);

            // var lat = flood[0]["la_crd"];

            // console.log(lat);


        });


    </script>
</body>

</html>
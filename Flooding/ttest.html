<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>안전할지도 - 도로 침수/결빙 위험및 돌발정보 안내지도</title>
    
    <!--Tmap api 사용-->
    <script
        src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=vqCR8cMhVh5aSpuDuOxJj5W4OQ46SWvU5rHuRI7H"></script>
</head>

<body>



    
    <div id="map"></div>

    <script>

        /*
        현재 위치의 위도 경도값을 얻어와서 지도의 center로 설정할 예정

        navigator.geolocation.getCurrentPosition()은 비동기적으로 동작하므로 위치 정보를 얻는데 시간이 소요되며 
        위치정보를 얻기 전에 지도를 그리려고 하는 문제가 발생할 수 있으므로
        Promise나 async/await 구문을 사용하여 위치정보를 받아온 다음 지도를 그리게 해야함
        */

        function getUserLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject("위치 정보가 지원되지 않습니다.");
                } else {
                    navigator.geolocation.getCurrentPosition(
                        position => resolve(position),
                        error => reject(error)
                    );
                }
            });
        }

        var map;

        async function drawMap() {
            try {
                const position = await getUserLocation();
                console.log(position);
                alert(`위도: ${position.coords.latitude}, 경도: ${position.coords.longitude}`);
                map = new Tmapv2.Map("map", {
                    center: new Tmapv2.LatLng(position.coords.latitude, position.coords.longitude),      //맵생성, 현재 위치의 위도와 경도를 center로 지정
                    width: "100%",
                    height: "95vh",
                    zoom: 12,
                });
            } catch (error) {
                console.error(error);

                // 위치 정보를 얻을 수 없을 때 부경대를 센터로 지정
                map = new Tmapv2.Map("map", {
                    center: new Tmapv2.LatLng(35.133238684709, 129.10144001966),         //부경대 위도경도
                    width: "100%",
                    height: "95vh",
                    zoom: 10,
                });
            }
        }

        drawMap();
    </script>
</body>

</html>